# AGENTS

Configuration for Glance, a self-hosted dashboard tool displaying system information, weather, calendar, and RSS feeds.

## Current Setup

- **Color scheme**: Zenwritten Dark
- **Font**: Zenbones Brainy
- **Custom CSS**: `assets/custom.css`
- **Favicon provider**: `https://twenty-icons.com/<domain>` (Twenty favicon; optional size `/64`, `/128`; source: https://github.com/twentyhq/favicon)
- **Server**: Running on `rvn-srv` at `http://192.168.1.46:8080`
- **Container**: Podman-based with systemd service

**Important:** Do not edit this file unless explicitly asked by the user.

## Documentation

Local documentation is available in `docs/agents/`:

- [Table of Contents](./docs/agents/TOC.md)
- [Configuration Guide](./docs/agents/configuration.md) - Full widget reference
- [Themes](./docs/agents/themes.md)
- [Custom API Widgets](./docs/agents/custom-api.md)
- [Extensions](./docs/agents/extensions.md)

**Note:** Always check [local documentation](./docs/agents/TOC.md) first before fetching from web.

## External References

- [Glance GitHub](https://github.com/glanceapp/glance)
- [Community Widgets](https://github.com/glanceapp/community-widgets)

## Pages & Columns

### Pages
Pages are defined through a top-level `pages` property. The first defined page becomes the home page. All pages are automatically added to the navigation bar in definition order.

**Key properties:**
- `name` (required): Page name shown in navigation
- `slug` (optional): URL-friendly name (auto-generated from name if not specified)
- `width`: Page width - `default` (1600px), `slim` (1100px, max 2 columns), or `wide` (1920px)
- `columns` (required): Array of column definitions
- `head-widgets` (optional): Widgets shown above columns, spanning full page width
- `hide-desktop-navigation`: Hide navigation bar on desktop
- `show-mobile-header`: Show page name header on mobile
- `center-vertically`: Vertically center content

Example:
```yaml
pages:
  - name: Home
    columns:
      - size: small
        widgets: ...
      - size: full
        widgets: ...
```

### Columns
Each page can have up to 3 columns. Column sizes:
- `small`: Fixed width (300px)
- `full`: Takes remaining width

**Requirements:**
- Must have 1 or 2 `full` columns per page
- `slim` pages support max 2 columns

**Common layouts:**
```yaml
# Layout 1: small-full-small (3 columns)
columns:
  - size: small
  - size: full
  - size: small

# Layout 2: full-small (2 columns)
columns:
  - size: full
  - size: small

# Layout 3: full-full (2 equal columns)
columns:
  - size: full
  - size: full
```

## Widget Organization

- **All custom widgets** should be created as separate files in the `widgets/` directory
- **Pages** should reference widgets using `$include: ../widgets/widget-name.yml`
- **Widget files** should start with `- ` (YAML list item) when using `$include`
- This keeps pages clean and widgets reusable across multiple pages

Example widget file (`widgets/example.yml`):
```yaml
- type: custom-api
  title: Example Widget
  # ... widget configuration
```

Example page usage:
```yaml
- name: Home
  columns:
    - size: small
      widgets:
        - $include: ../widgets/example.yml
```

## Widget Configuration

### Quick Reference

All widgets share common properties (title, cache, css-class, etc.). For complete details:

**Read [configuration.md](./docs/agents/configuration.md):**
- **Lines 69-98**: Environment variables (`${ENV_VAR}` syntax)
- **Lines 100-131**: Secrets (Docker secrets, file-based secrets)
- **Lines 132-188**: Including config files (`$include`)
- **Lines 189-212**: Icons (si:, sh:, di:, mdi: prefixes)
- **Lines 702-744**: Shared widget properties (type, title, cache, hide-header, css-class)

### Widget Types

For specific widget configuration, read these sections in [configuration.md](./docs/agents/configuration.md):

| Widget Type | Lines | Description |
|-------------|-------|-------------|
| **RSS** | 745-849 | RSS feeds with multiple styles |
| **Videos** | 850-935 | YouTube channels/playlists |
| **Hacker News** | 936-977 | HN posts |
| **Lobsters** | 978-1028 | Lobsters posts |
| **Reddit** | 1029-1182 | Subreddit posts |
| **Search** | 1183-1281 | Search widget with bangs |
| **Group** | 1282-1325 | Tab-based widget grouping |
| **Split Column** | 1326-1469 | Horizontal column division |
| **Custom API** | 1470-1759 | JSON API with Go templates |
| **Extension** | 1760-1803 | External 3rd party widgets |
| **Weather** | 1804-1865 | Weather information |
| **Todo** | 1866-1903 | Simple todo list |
| **Monitor** | 1904-2022 | Site uptime monitoring |
| **Releases** | 2023-2128 | GitHub/GitLab/etc releases |
| **Docker Containers** | 2129-2306 | Container status display |
| **DNS Stats** | 2307-2372 | AdGuard/Pi-hole/Technitium stats |
| **Server Stats** | 2373-2490 | CPU/RAM/disk usage |
| **Repository** | 2491-2532 | GitHub repo info |
| **Bookmarks** | 2533-2626 | Grouped bookmarks |
| **ChangeDetection** | 2627-2673 | ChangeDetection.io integration |
| **Clock** | 2674-2718 | Clock with timezones |
| **Calendar** | 2719-2741 | iCal calendars |
| **Markets** | 2773-2849 | Stock market data |
| **Twitch Channels** | 2850-2885 | Twitch channel status |
| **iframe** | 2926-2948 | Embedded iframes |
| **HTML** | 2949+ | Custom HTML content |

### Common Patterns

**Environment variables:**
```yaml
url: ${API_URL}
headers:
  x-api-key: ${API_KEY}
```

**Icons:**
```yaml
icon: si:immich          # Simple Icons
icon: sh:immich          # selfh.st icons
icon: di:immich          # Dashboard Icons
icon: mdi:camera         # Material Design Icons
icon: /assets/icon.png   # Local asset
icon: auto-invert sh:icon  # Auto-invert for dark theme
```

**Widget groups:**
```yaml
- type: group
  widgets:
    - type: hacker-news
    - type: lobsters
```

**Split columns:**
```yaml
- type: split-column
  max-columns: 3
  widgets: ...
```

## Debugging & Troubleshooting

### Checking for Configuration Errors

After making changes to widget files or `glance.yml`, check the Glance service logs for errors:

```bash
# On rvn-srv, check systemd logs
journalctl --user -u glance.service -f
```

**Look for:**
- `Config file changed, reloading...` - Glance detected your changes
- `Config has errors:` - Template syntax or configuration errors

**Common errors:**

1. **Template function errors:**
   ```
   Config has errors: custom-api widget: parsing template: template: :7: function "list" not defined
   ```
   - **Cause:** Using undefined Go template functions
   - **Fix:** Go templates have limited functions. Use only built-in functions like `range`, `if`, `eq`, `add`, etc.

2. **YAML syntax errors:**
   ```
   Config has errors: yaml: line X: mapping values are not allowed in this context
   ```
   - **Cause:** Incorrect YAML indentation or syntax
   - **Fix:** Check indentation (use spaces, not tabs) and proper YAML structure

3. **Environment variable not found:**
   ```
   Get "https://...": context deadline exceeded
   ```
   - **Cause:** Missing environment variable (e.g., `${LINKWARDEN_TOKEN}`)
   - **Fix:** Add required environment variables to service configuration

### Hot Reload

Glance automatically reloads when config files change. No manual restart needed unless:
- Adding new environment variables (requires service restart)
- Changing systemd service configuration
- Adding new asset files (may need browser cache clear)

## Special Configurations

### Container Widget Setup

The Services page uses a `docker-containers` widget configured to work with Podman. For this to function:

1. Enable Podman socket (if not already running):
   ```bash
   systemctl --user enable --now podman.socket
   ```

2. Mount the Podman socket to Glance container in your Podman/systemd service:
   ```yaml
   volumes:
     - /run/user/$(id -u)/podman/podman.sock:/run/podman/podman.sock:ro
   ```

3. The widget is configured with `sock-path: /run/podman/podman.sock` in `widgets/containers.yml`

### Client-Side JavaScript

For widgets that need client-side functionality (like the Mullvad VPN widget):

1. Create JavaScript file in `assets/` directory (e.g., `assets/mullvad-check.js`)
2. Load script globally in `glance.yml`:
   ```yaml
   document:
     head: |
       <script src="/assets/mullvad-check.js"></script>
   ```
3. Widget HTML should use data attributes (e.g., `data-mullvad-check`) for the script to target
4. Script checks for presence of data attribute before executing

### Environment Variables

Required environment variables for current widgets:

```bash
# Synology Disk Station Widget
SYNOLOGY_URL=https://corvus-corax.synology.me
SYNOLOGY_USERNAME=glance-api
SYNOLOGY_PASSWORD=<password>

# Add to Podman/systemd service or docker-compose
```
